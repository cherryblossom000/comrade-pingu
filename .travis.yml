language: node_js
os:
- linux
- osx
node_js:
- lts/*
- v12.18.3
branches:
  except: repl

before_install: npm i -g pnpm
install: pnpm i
script:
- pnpm -C packages/commitlint-plugin build
- pnpx commitlint-travis
- pnpm build
- pnpm lint
- pnpm test

jobs:
  include:
    stage: Update Docs and Deploy
    script:
    - pnpm -C packages/bot build
    - pnpm -C packages/semantic-release build
    after_success: chmod +x scripts/push-docs.sh && scripts/push-docs.sh
    deploy:
    - provider: script
      skip_cleanup: true
      script: chmod +x scripts/deploy.sh && scripts/deploy.sh
      on: master
  fast_finish: true
